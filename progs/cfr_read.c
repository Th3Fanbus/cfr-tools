/* SPDX-License-Identifier: GPL-2.0-only */

#include <assert.h>
#include <inttypes.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "cfr.h"

static __attribute__((aligned(4))) uint8_t cfr_raw_data[] = {
	0x00, 0x01, 0x00, 0x00, 0xa0, 0x0c, 0x00, 0x00, 0x54, 0x1a, 0x95, 0x9e, 0x01, 0x01, 0x00, 0x00,
	0x94, 0x0c, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x14, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x4d, 0x61, 0x69, 0x6e, 0x00, 0x00, 0x00, 0x00,
	0x06, 0x01, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,
	0x07, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x73, 0x65, 0x72, 0x69,
	0x61, 0x6c, 0x5f, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x1c, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x53, 0x65, 0x72, 0x69, 0x61, 0x6c, 0x20, 0x4e,
	0x75, 0x6d, 0x62, 0x65, 0x72, 0x00, 0x00, 0x00, 0x0a, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
	0x0d, 0x00, 0x00, 0x00, 0x73, 0x65, 0x72, 0x69, 0x61, 0x6c, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72,
	0x00, 0x00, 0x00, 0x00, 0x06, 0x01, 0x00, 0x00, 0x58, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
	0x09, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00,
	0x70, 0x61, 0x72, 0x74, 0x5f, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x18, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x50, 0x61, 0x72, 0x74, 0x20, 0x4e, 0x75, 0x6d,
	0x62, 0x65, 0x72, 0x00, 0x0a, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00,
	0x70, 0x61, 0x72, 0x74, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72, 0x00, 0x00, 0x0b, 0x01, 0x00, 0x00,
	0x40, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x30, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x57, 0x41, 0x52, 0x4e, 0x49, 0x4e, 0x47, 0x3a,
	0x20, 0x50, 0x72, 0x6f, 0x66, 0x69, 0x6c, 0x65, 0x20, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x69, 0x73,
	0x20, 0x69, 0x6e, 0x76, 0x61, 0x6c, 0x69, 0x64, 0x00, 0x00, 0x00, 0x00, 0x04, 0x01, 0x00, 0x00,
	0x7c, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x2a, 0x00, 0x00, 0x00,
	0x07, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x70, 0x72, 0x6f, 0x66,
	0x69, 0x6c, 0x65, 0x00, 0x08, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00,
	0x50, 0x72, 0x6f, 0x66, 0x69, 0x6c, 0x65, 0x20, 0x63, 0x6f, 0x64, 0x65, 0x00, 0x00, 0x00, 0x00,
	0x09, 0x01, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x54, 0x68, 0x65, 0x20,
	0x70, 0x72, 0x6f, 0x66, 0x69, 0x6c, 0x65, 0x20, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x6f, 0x62, 0x74,
	0x61, 0x69, 0x6e, 0x65, 0x64, 0x20, 0x66, 0x72, 0x6f, 0x6d, 0x20, 0x74, 0x68, 0x65, 0x20, 0x45,
	0x45, 0x50, 0x52, 0x4f, 0x4d, 0x00, 0x00, 0x00, 0x03, 0x01, 0x00, 0x00, 0x30, 0x01, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x5f, 0x6f, 0x6e,
	0x5f, 0x61, 0x66, 0x74, 0x65, 0x72, 0x5f, 0x66, 0x61, 0x69, 0x6c, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x24, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x52, 0x65, 0x73, 0x74, 0x6f, 0x72, 0x65, 0x20,
	0x41, 0x43, 0x20, 0x50, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x4c, 0x6f, 0x73, 0x73, 0x00, 0x00, 0x00,
	0x09, 0x01, 0x00, 0x00, 0x88, 0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x53, 0x70, 0x65, 0x63,
	0x69, 0x66, 0x79, 0x20, 0x77, 0x68, 0x61, 0x74, 0x20, 0x74, 0x6f, 0x20, 0x64, 0x6f, 0x20, 0x77,
	0x68, 0x65, 0x6e, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x69, 0x73, 0x20, 0x72, 0x65, 0x2d,
	0x61, 0x70, 0x70, 0x6c, 0x69, 0x65, 0x64, 0x20, 0x61, 0x66, 0x74, 0x65, 0x72, 0x20, 0x61, 0x20,
	0x70, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x6c, 0x6f, 0x73, 0x73, 0x2e, 0x20, 0x54, 0x68, 0x69, 0x73,
	0x20, 0x6f, 0x70, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x68, 0x61, 0x73, 0x20, 0x6e, 0x6f, 0x20, 0x65,
	0x66, 0x66, 0x65, 0x63, 0x74, 0x20, 0x6f, 0x6e, 0x20, 0x73, 0x79, 0x73, 0x74, 0x65, 0x6d, 0x73,
	0x20, 0x77, 0x69, 0x74, 0x68, 0x6f, 0x75, 0x74, 0x20, 0x61, 0x20, 0x52, 0x54, 0x43, 0x20, 0x62,
	0x61, 0x74, 0x74, 0x65, 0x72, 0x79, 0x2e, 0x00, 0x02, 0x01, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00,
	0x50, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x6f, 0x66, 0x66, 0x20, 0x28, 0x53, 0x35, 0x29, 0x00, 0x00,
	0x02, 0x01, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x1c, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x50, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x6f, 0x6e,
	0x20, 0x28, 0x53, 0x30, 0x29, 0x00, 0x00, 0x00, 0x03, 0x01, 0x00, 0x00, 0x24, 0x01, 0x00, 0x00,
	0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00,
	0x1c, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x70, 0x72, 0x69, 0x6d, 0x61, 0x72, 0x79, 0x5f,
	0x64, 0x69, 0x73, 0x70, 0x6c, 0x61, 0x79, 0x00, 0x08, 0x01, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00,
	0x17, 0x00, 0x00, 0x00, 0x50, 0x72, 0x69, 0x6d, 0x61, 0x72, 0x79, 0x20, 0x64, 0x69, 0x73, 0x70,
	0x6c, 0x61, 0x79, 0x20, 0x64, 0x65, 0x76, 0x69, 0x63, 0x65, 0x00, 0x00, 0x09, 0x01, 0x00, 0x00,
	0x3c, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x53, 0x70, 0x65, 0x63, 0x69, 0x66, 0x79, 0x20,
	0x77, 0x68, 0x69, 0x63, 0x68, 0x20, 0x64, 0x69, 0x73, 0x70, 0x6c, 0x61, 0x79, 0x20, 0x64, 0x65,
	0x76, 0x69, 0x63, 0x65, 0x20, 0x74, 0x6f, 0x20, 0x75, 0x73, 0x65, 0x20, 0x61, 0x73, 0x20, 0x70,
	0x72, 0x69, 0x6d, 0x61, 0x72, 0x79, 0x2e, 0x00, 0x02, 0x01, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00,
	0x49, 0x6e, 0x74, 0x65, 0x6c, 0x20, 0x69, 0x47, 0x50, 0x55, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x28, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
	0x0d, 0x00, 0x00, 0x00, 0x43, 0x50, 0x55, 0x20, 0x50, 0x45, 0x47, 0x20, 0x64, 0x47, 0x50, 0x55,
	0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x50, 0x43, 0x48, 0x20,
	0x50, 0x43, 0x49, 0x65, 0x20, 0x64, 0x47, 0x50, 0x55, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x41, 0x75, 0x74, 0x6f, 0x00, 0x00, 0x00, 0x00, 0x03, 0x01, 0x00, 0x00,
	0x98, 0x01, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00,
	0x07, 0x01, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x70, 0x6b, 0x67, 0x5f,
	0x63, 0x5f, 0x73, 0x74, 0x61, 0x74, 0x65, 0x5f, 0x6c, 0x69, 0x6d, 0x69, 0x74, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x50, 0x61, 0x63, 0x6b,
	0x61, 0x67, 0x65, 0x20, 0x43, 0x2d, 0x73, 0x74, 0x61, 0x74, 0x65, 0x20, 0x6c, 0x69, 0x6d, 0x69,
	0x74, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x43, 0x30, 0x2f, 0x43,
	0x31, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x43, 0x32, 0x00, 0x00,
	0x02, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x10, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x43, 0x33, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x1c, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
	0x03, 0x00, 0x00, 0x00, 0x43, 0x36, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
	0x04, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
	0x43, 0x37, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x43, 0x37, 0x53, 0x00,
	0x02, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x10, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x43, 0x38, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x1c, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
	0x03, 0x00, 0x00, 0x00, 0x43, 0x39, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
	0x08, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
	0x43, 0x31, 0x30, 0x00, 0x02, 0x01, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x44, 0x65, 0x66, 0x61,
	0x75, 0x6c, 0x74, 0x00, 0x02, 0x01, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x41, 0x75, 0x74, 0x6f,
	0x00, 0x00, 0x00, 0x00, 0x03, 0x01, 0x00, 0x00, 0x08, 0x03, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
	0x11, 0x00, 0x00, 0x00, 0x70, 0x63, 0x68, 0x5f, 0x70, 0x63, 0x69, 0x65, 0x5f, 0x70, 0x6c, 0x6c,
	0x5f, 0x73, 0x73, 0x63, 0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00,
	0x26, 0x00, 0x00, 0x00, 0x50, 0x43, 0x48, 0x20, 0x50, 0x43, 0x49, 0x65, 0x20, 0x50, 0x4c, 0x4c,
	0x20, 0x53, 0x70, 0x72, 0x65, 0x61, 0x64, 0x20, 0x53, 0x70, 0x65, 0x63, 0x74, 0x72, 0x75, 0x6d,
	0x20, 0x43, 0x6c, 0x6f, 0x63, 0x6b, 0x69, 0x6e, 0x67, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x30, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x31, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x32, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x33, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x34, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x35, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x36, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x37, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x38, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x30, 0x2e, 0x39, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x30, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x31, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x32, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x33, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x34, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x35, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x36, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x37, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x38, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x31, 0x2e, 0x39, 0x25, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00,
	0x20, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,
	0x05, 0x00, 0x00, 0x00, 0x41, 0x75, 0x74, 0x6f, 0x00, 0x00, 0x00, 0x00, 0x05, 0x01, 0x00, 0x00,
	0x88, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
	0x07, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x63, 0x5f, 0x73, 0x74,
	0x61, 0x74, 0x65, 0x73, 0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00,
	0x1c, 0x00, 0x00, 0x00, 0x43, 0x50, 0x55, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x73, 0x74,
	0x61, 0x74, 0x65, 0x73, 0x20, 0x28, 0x43, 0x2d, 0x73, 0x74, 0x61, 0x74, 0x65, 0x73, 0x29, 0x00,
	0x09, 0x01, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x53, 0x70, 0x65, 0x63,
	0x69, 0x66, 0x79, 0x20, 0x77, 0x68, 0x65, 0x74, 0x68, 0x65, 0x72, 0x20, 0x43, 0x2d, 0x73, 0x74,
	0x61, 0x74, 0x65, 0x73, 0x20, 0x61, 0x72, 0x65, 0x20, 0x73, 0x75, 0x70, 0x70, 0x6f, 0x72, 0x74,
	0x65, 0x64, 0x2e, 0x00, 0x05, 0x01, 0x00, 0x00, 0x58, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
	0x10, 0x00, 0x00, 0x00, 0x68, 0x79, 0x70, 0x65, 0x72, 0x5f, 0x74, 0x68, 0x72, 0x65, 0x61, 0x64,
	0x69, 0x6e, 0x67, 0x00, 0x08, 0x01, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x1b, 0x00, 0x00, 0x00,
	0x48, 0x79, 0x70, 0x65, 0x72, 0x2d, 0x54, 0x68, 0x72, 0x65, 0x61, 0x64, 0x69, 0x6e, 0x67, 0x20,
	0x54, 0x65, 0x63, 0x68, 0x6e, 0x6f, 0x6c, 0x6f, 0x67, 0x79, 0x00, 0x00, 0x05, 0x01, 0x00, 0x00,
	0x44, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
	0x07, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x74, 0x75, 0x72, 0x62,
	0x6f, 0x5f, 0x6d, 0x6f, 0x64, 0x65, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00,
	0x0c, 0x00, 0x00, 0x00, 0x54, 0x75, 0x72, 0x62, 0x6f, 0x20, 0x42, 0x6f, 0x6f, 0x73, 0x74, 0x00,
	0x05, 0x01, 0x00, 0x00, 0x58, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00,
	0x65, 0x6e, 0x65, 0x72, 0x67, 0x79, 0x5f, 0x65, 0x66, 0x66, 0x5f, 0x74, 0x75, 0x72, 0x62, 0x6f,
	0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00,
	0x45, 0x6e, 0x65, 0x72, 0x67, 0x79, 0x20, 0x45, 0x66, 0x66, 0x69, 0x63, 0x69, 0x65, 0x6e, 0x74,
	0x20, 0x54, 0x75, 0x72, 0x62, 0x6f, 0x00, 0x00, 0x05, 0x01, 0x00, 0x00, 0x58, 0x00, 0x00, 0x00,
	0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00,
	0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x76, 0x6d, 0x78, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x34, 0x00, 0x00, 0x00, 0x27, 0x00, 0x00, 0x00, 0x49, 0x6e, 0x74, 0x65, 0x6c, 0x20, 0x56, 0x69,
	0x72, 0x74, 0x75, 0x61, 0x6c, 0x69, 0x7a, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x54, 0x65, 0x63,
	0x68, 0x6e, 0x6f, 0x6c, 0x6f, 0x67, 0x79, 0x20, 0x28, 0x56, 0x54, 0x2d, 0x78, 0x29, 0x00, 0x00,
	0x05, 0x01, 0x00, 0x00, 0x68, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
	0x76, 0x74, 0x64, 0x00, 0x08, 0x01, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00,
	0x49, 0x6e, 0x74, 0x65, 0x6c, 0x20, 0x56, 0x69, 0x72, 0x74, 0x75, 0x61, 0x6c, 0x69, 0x7a, 0x61,
	0x74, 0x69, 0x6f, 0x6e, 0x20, 0x54, 0x65, 0x63, 0x68, 0x6e, 0x6f, 0x6c, 0x6f, 0x67, 0x79, 0x20,
	0x66, 0x6f, 0x72, 0x20, 0x44, 0x69, 0x72, 0x65, 0x63, 0x74, 0x65, 0x64, 0x20, 0x49, 0x2f, 0x4f,
	0x20, 0x28, 0x56, 0x54, 0x2d, 0x64, 0x29, 0x00, 0x05, 0x01, 0x00, 0x00, 0x04, 0x01, 0x00, 0x00,
	0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00,
	0x14, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x69, 0x62, 0x65, 0x63, 0x63, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x49, 0x6e, 0x2d, 0x42,
	0x61, 0x6e, 0x64, 0x20, 0x45, 0x43, 0x43, 0x00, 0x09, 0x01, 0x00, 0x00, 0xc4, 0x00, 0x00, 0x00,
	0xb7, 0x00, 0x00, 0x00, 0x53, 0x70, 0x65, 0x63, 0x69, 0x66, 0x79, 0x20, 0x77, 0x68, 0x65, 0x74,
	0x68, 0x65, 0x72, 0x20, 0x49, 0x6e, 0x2d, 0x42, 0x61, 0x6e, 0x64, 0x20, 0x65, 0x72, 0x72, 0x6f,
	0x72, 0x20, 0x63, 0x68, 0x65, 0x63, 0x6b, 0x69, 0x6e, 0x67, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x63,
	0x6f, 0x72, 0x72, 0x65, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x69, 0x73, 0x20, 0x74, 0x6f, 0x20,
	0x62, 0x65, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c, 0x65, 0x64, 0x2e, 0x20, 0x45, 0x6e, 0x61, 0x62,
	0x6c, 0x69, 0x6e, 0x67, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x6f, 0x70, 0x74, 0x69, 0x6f, 0x6e,
	0x20, 0x77, 0x69, 0x6c, 0x6c, 0x20, 0x72, 0x65, 0x64, 0x75, 0x63, 0x65, 0x20, 0x74, 0x68, 0x65,
	0x20, 0x61, 0x6d, 0x6f, 0x75, 0x6e, 0x74, 0x20, 0x6f, 0x66, 0x20, 0x61, 0x76, 0x61, 0x69, 0x6c,
	0x61, 0x62, 0x6c, 0x65, 0x20, 0x52, 0x41, 0x4d, 0x20, 0x62, 0x65, 0x63, 0x61, 0x75, 0x73, 0x65,
	0x20, 0x73, 0x6f, 0x6d, 0x65, 0x20, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x20, 0x69, 0x73, 0x20,
	0x6e, 0x65, 0x65, 0x64, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x73, 0x74, 0x6f, 0x72, 0x65, 0x20,
	0x45, 0x43, 0x43, 0x20, 0x63, 0x6f, 0x64, 0x65, 0x73, 0x2e, 0x00, 0x00, 0x05, 0x01, 0x00, 0x00,
	0x58, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x07, 0x01, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x6c, 0x6c, 0x63, 0x5f,
	0x64, 0x65, 0x61, 0x64, 0x5f, 0x6c, 0x69, 0x6e, 0x65, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
	0x28, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x4c, 0x4c, 0x43, 0x20, 0x44, 0x65, 0x61, 0x64,
	0x20, 0x4c, 0x69, 0x6e, 0x65, 0x20, 0x41, 0x6c, 0x6c, 0x6f, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e,
	0x00, 0x00, 0x00, 0x00, 0x05, 0x01, 0x00, 0x00, 0x6c, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x01, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00,
	0x0a, 0x00, 0x00, 0x00, 0x70, 0x63, 0x69, 0x65, 0x5f, 0x73, 0x72, 0x69, 0x73, 0x00, 0x00, 0x00,
	0x08, 0x01, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x33, 0x00, 0x00, 0x00, 0x50, 0x43, 0x49, 0x65,
	0x20, 0x53, 0x65, 0x70, 0x61, 0x72, 0x61, 0x74, 0x65, 0x20, 0x52, 0x65, 0x66, 0x65, 0x72, 0x65,
	0x6e, 0x63, 0x65, 0x20, 0x43, 0x6c, 0x6f, 0x63, 0x6b, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x49,
	0x6e, 0x64, 0x65, 0x70, 0x65, 0x6e, 0x64, 0x65, 0x6e, 0x74, 0x20, 0x53, 0x53, 0x43, 0x00, 0x00,
};

static int depth = 0;

static void print_tabs(void)
{
	for (int i = 0; i < depth; i++) {
		printf("\t");
	}
}

#define cfr_log(fmt, ...) \
	do { print_tabs(); printf(fmt, ##__VA_ARGS__); } while (0)

#define cfr_log_prop(_prop) \
	do { cfr_log("%s: ", _prop); } while (0)

#define cfr_log_prop_val(_fmt, _prop, _val) \
	do { cfr_log("%-12s ", _prop ":"); printf(_fmt "\n", _val); } while (0)

#define LOG_HEX "0x%x"
#define LOG_NUM "%u"
#define LOG_STR "%s"
#define LOG_SQU "\"%s\""

static void inc_depth(void)
{
	cfr_log("%c\n", '{');
	depth++;
}

static void dec_depth(void)
{
	depth--;
	cfr_log("}%c\n", depth > 0 ? ',' : ';');
}

static const char *tag_to_string(uint32_t tag)
{
	static char buffer[50] = {0};

	switch (tag) {
	case LB_TAG_CFR:			return "Root record";
	case LB_TAG_CFR_OPTION_FORM:		return "Form";
	case LB_TAG_CFR_ENUM_VALUE:		return "Enum value";
	case LB_TAG_CFR_OPTION_ENUM:		return "Enum option";
	case LB_TAG_CFR_OPTION_NUMBER:		return "Number option";
	case LB_TAG_CFR_OPTION_BOOL:		return "Bool option";
	case LB_TAG_CFR_OPTION_VARCHAR:		return "Varchar option";
	case LB_TAG_CFR_VARCHAR_OPT_NAME:	return "Option name";
	case LB_TAG_CFR_VARCHAR_UI_NAME:	return "UI name";
	case LB_TAG_CFR_VARCHAR_UI_HELPTEXT:	return "UI help text";
	case LB_TAG_CFR_VARCHAR_DEF_VALUE:	return "Default value";
	case LB_TAG_CFR_OPTION_COMMENT:		return "Option comment";
	default:
		snprintf(buffer, sizeof(buffer), "UNKNOWN (0x%x)", tag);
		return buffer;
	}
}

static void _print_record(const struct lb_record *rec, const char *f)
{
	const uintptr_t addr = (uintptr_t)(char *)rec;
	if (addr & 0x3) {
		fprintf(stderr, "%s: Address %" PRIxPTR " is not aligned, bailing\n", f, addr);
		exit(-1);
	}

	cfr_log("CFR '%s':\n", tag_to_string(rec->tag));
	cfr_log_prop_val(LOG_HEX, "tag", rec->tag);
	cfr_log_prop_val(LOG_NUM, "size", rec->size);
}

#define print_record(_rec) _print_record((const struct lb_record *)(_rec), __func__)

static bool _tag_neq(const struct lb_record *rec, uint32_t tag, const char *f)
{
	if (rec->tag != tag && tag != LB_TAG_CFR_VARCHAR_UI_HELPTEXT) {
		fprintf(stdout, "%s: expected a '%s' but ", f, tag_to_string(tag));
		fprintf(stdout, "got a '%s' instead\n", tag_to_string(rec->tag));
	}
	return rec->tag != tag;
}

#define tag_mismatch(_rec, _tag) _tag_neq((const struct lb_record *)(_rec), (_tag), __func__)

static void _tag_ok(const struct lb_record *rec, uint32_t tag, const char *f)
{
	if (rec->tag != tag) {
		fprintf(stderr, "%s: expected a '%s' but ", f, tag_to_string(tag));
		fprintf(stderr, "got a '%s' instead, bailing\n", tag_to_string(rec->tag));
		exit(-1);
	}
}

#define ensure_tag_ok(_rec, _tag) _tag_ok((const struct lb_record *)(_rec), (_tag), __func__)

static const char *print_flags(uint32_t flags)
{
	const struct {
		uint32_t flag;
		const char *text;
	} flags_to_text[] = {
		{ CFR_OPTFLAG_READONLY, "read-only"  },
		{ CFR_OPTFLAG_GRAYOUT,  "grayed out" },
		{ CFR_OPTFLAG_SUPPRESS, "suppressed" },
		{ CFR_OPTFLAG_VOLATILE, "volatile"   },
	};

	static char buffer[300] = {0};

	snprintf(buffer, sizeof(buffer), "0x%x (", flags);

	unsigned int num_flags = 0;
	for (unsigned int i = 0; i < ARRAY_SIZE(flags_to_text); i++) {
		if ((flags & flags_to_text[i].flag) == 0) {
			continue;
		}
		if (num_flags != 0) {
			strcat(buffer, ", ");
		}
		strcat(buffer, flags_to_text[i].text);
		num_flags++;
	}
	if (flags == 0) {
		strcat(buffer, "none");
	}
	strcat(buffer, ")");

	return buffer;
}

static uint32_t read_cfr_varchar(char *current, uint32_t tag)
{
	struct lb_cfr_varbinary *cfr_str = (struct lb_cfr_varbinary *)current;

	if (tag_mismatch(cfr_str, tag)) {
		printf("<not found>\n");
		if (tag == LB_TAG_CFR_VARCHAR_UI_HELPTEXT) {
			return 0;
		}
		printf("[HEXDUMP BEGIN]\n");
		for (uint32_t i = 0; i < cfr_str->size; i++) {
			printf("%02x ", ((uint8_t *)current)[i]);
			if ((i & 0xf) == 0xf) {
				printf("\t");
				for (uint32_t j = (i & ~0xf); j <= i; j++) {
					printf("%c", current[j]);
				}
				printf("\n");
			}
		}
		printf("[HEXDUMP END]\n");
		exit(-1);
	}

	printf("\n");
	inc_depth();

	print_record(cfr_str);
	cfr_log_prop_val(LOG_NUM, "data length", cfr_str->data_length);
	cfr_log_prop_val(LOG_SQU, "data", cfr_str->data);

	dec_depth();

	assert(cfr_str->size > cfr_str->data_length);
	return cfr_str->size;
}

static uint32_t sm_read_string_default_value(char *current)
{
	cfr_log_prop("defval");
	return read_cfr_varchar(current, LB_TAG_CFR_VARCHAR_DEF_VALUE);
}

static uint32_t sm_read_opt_name(char *current)
{
	cfr_log_prop("option name");
	return read_cfr_varchar(current, LB_TAG_CFR_VARCHAR_OPT_NAME);
}

static uint32_t sm_read_ui_name(char *current)
{
	cfr_log_prop("UI name");
	return read_cfr_varchar(current, LB_TAG_CFR_VARCHAR_UI_NAME);
}

static uint32_t sm_read_ui_helptext(char *current)
{
	cfr_log_prop("UI help text");
	return read_cfr_varchar(current, LB_TAG_CFR_VARCHAR_UI_HELPTEXT);
}

static uint32_t sm_read_enum_value(char *current)
{
	struct lb_cfr_enum_value *enum_val = (struct lb_cfr_enum_value *)current;
	char *const limit = current + enum_val->size;

	print_record(enum_val);
	cfr_log_prop_val(LOG_NUM, "value", enum_val->value);

	current += sizeof(*enum_val);
	current += sm_read_ui_name(current);

	assert(current == limit);
	return enum_val->size;
}

static uint32_t read_numeric_option(char *current, uint32_t tag)
{
	struct lb_cfr_numeric_option *option = (struct lb_cfr_numeric_option *)current;
	char *const limit = current + option->size;

	ensure_tag_ok(option, tag);

	print_record(option);
	cfr_log_prop_val(LOG_NUM, "object ID", option->object_id);
	cfr_log_prop_val(LOG_STR, "flags", print_flags(option->flags));
	cfr_log_prop_val(LOG_NUM, "defval", option->default_value);

	current += sizeof(*option);
	current += sm_read_opt_name(current);
	current += sm_read_ui_name(current);
	current += sm_read_ui_helptext(current);

	if (option->tag == LB_TAG_CFR_OPTION_ENUM) {
		cfr_log_prop("enum values");
		printf("\n");
		while (current < limit) {
			inc_depth();
			current += sm_read_enum_value(current);
			dec_depth();
		}
	}

	assert(current == limit);
	return option->size;
}

static uint32_t sm_read_opt_enum(char *current)
{
	return read_numeric_option(current, LB_TAG_CFR_OPTION_ENUM);
}

static uint32_t sm_read_opt_number(char *current)
{
	return read_numeric_option(current, LB_TAG_CFR_OPTION_NUMBER);
}

static uint32_t sm_read_opt_bool(char *current)
{
	return read_numeric_option(current, LB_TAG_CFR_OPTION_BOOL);
}

static uint32_t sm_read_opt_varchar(char *current)
{
	struct lb_cfr_varchar_option *option = (struct lb_cfr_varchar_option *)current;
	char *const limit = current + option->size;

	ensure_tag_ok(option, LB_TAG_CFR_OPTION_VARCHAR);

	print_record(option);
	cfr_log_prop_val(LOG_NUM, "object ID", option->object_id);
	cfr_log_prop_val(LOG_STR, "flags", print_flags(option->flags));

	current += sizeof(*option);
	current += sm_read_opt_name(current);
	current += sm_read_ui_name(current);
	current += sm_read_ui_helptext(current);
	current += sm_read_string_default_value(current);

	assert(current == limit);
	return option->size;
}

static uint32_t sm_read_opt_comment(char *current)
{
	struct lb_cfr_option_comment *comment = (struct lb_cfr_option_comment *)current;
	char *const limit = current + comment->size;

	ensure_tag_ok(comment, LB_TAG_CFR_OPTION_COMMENT);

	print_record(comment);
	cfr_log_prop_val(LOG_NUM, "object ID", comment->object_id);
	cfr_log_prop_val(LOG_STR, "flags", print_flags(comment->flags));

	current += sizeof(*comment);
	current += sm_read_ui_name(current);
	current += sm_read_ui_helptext(current);

	assert(current == limit);
	return comment->size;
}

static uint32_t sm_read_object(char *current);

static uint32_t sm_read_form(char *current)
{
	struct lb_cfr_option_form *form = (struct lb_cfr_option_form *)current;
	char *const limit = current + form->size;

	ensure_tag_ok(form, LB_TAG_CFR_OPTION_FORM);

	print_record(form);
	cfr_log_prop_val(LOG_NUM, "object ID", form->object_id);
	cfr_log_prop_val(LOG_STR, "flags", print_flags(form->flags));

	current += sizeof(*form);
	current += sm_read_ui_name(current);

	cfr_log_prop("object list");
	printf("\n");
	while (current < limit) {
		current += sm_read_object(current);
	}

	assert(current == limit);
	return form->size;
}

static uint32_t _sm_read_object(char *current)
{
	struct lb_record *rec = (struct lb_record *)current;

	switch (rec->tag) {
	case LB_TAG_CFR_OPTION_ENUM:
		return sm_read_opt_enum(current);
	case LB_TAG_CFR_OPTION_NUMBER:
		return sm_read_opt_number(current);
	case LB_TAG_CFR_OPTION_BOOL:
		return sm_read_opt_bool(current);
	case LB_TAG_CFR_OPTION_VARCHAR:
		return sm_read_opt_varchar(current);
	case LB_TAG_CFR_OPTION_COMMENT:
		return sm_read_opt_comment(current);
	case LB_TAG_CFR_OPTION_FORM:
		return sm_read_form(current);
	default:
		print_record(rec);
		return rec->size;
	}
}

static uint32_t sm_read_object(char *current)
{
	inc_depth();
	const uint32_t ret = _sm_read_object(current);
	dec_depth();
	return ret;
}

static void sm_read_cfr(char *current)
{
	struct lb_cfr *cfr_root = (struct lb_cfr *)current;
	char *const limit = current + cfr_root->size;

	ensure_tag_ok(cfr_root, LB_TAG_CFR);

	print_record(cfr_root);
	cfr_log_prop_val(LOG_HEX, "checksum", cfr_root->checksum);

	current += sizeof(*cfr_root);

	cfr_log_prop("form list");
	printf("\n");
	while (current < limit) {
		current += sm_read_object(current);
	}

	assert(current == limit);

	printf("length:  %ld\n", (long int)(current - (char *)cfr_root));
	printf("size:    %u\n", cfr_root->size);

	printf("depth:   %d\n", depth);
}

int main(void)
{
	sm_read_cfr((char *)cfr_raw_data);
	return 0;
}
